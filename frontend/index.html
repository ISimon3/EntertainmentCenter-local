<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿è’™å°¼æ–¯å¨±ä¹åŸ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <i class="fas fa-gamepad"></i>
                    <span>è¥¿è’™å°¼æ–¯å¨±ä¹åŸ</span>
                </div>
                <div class="nav-menu">
                    <a href="#" class="nav-link" onclick="showSection('home')">é¦–é¡µ</a>
                    <a href="#" class="nav-link" onclick="showSection('games')">æ¸¸æˆå¤§å…</a>
                    <a href="#" class="nav-link" onclick="showSection('stats')">æ•°æ®ç»Ÿè®¡</a>
                    <a href="#" class="nav-link" onclick="showSection('profile')">ä¸ªäººä¸­å¿ƒ</a>
                </div>
                <div class="nav-user">
                    <div id="user-info" class="user-info" style="display: none;">
                        <span id="username"></span>
                        <span id="credits" class="credits">0 å…ƒ</span>
                        <button onclick="logout()" class="btn btn-outline">é€€å‡º</button>
                    </div>
                    <div id="auth-buttons" class="auth-buttons">
                        <button onclick="showLogin()" class="btn btn-primary">ç™»å½•</button>
                        <button onclick="showRegister()" class="btn btn-outline">æ³¨å†Œ</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- é¦–é¡µ -->
            <section id="home-section" class="section active">
                <div class="hero">
                    <div class="hero-content">
                        <h1>ğŸ® æ¬¢è¿æ¥åˆ°è¥¿è’™å°¼æ–¯å¨±ä¹åŸ ğŸ®</h1>
                        <p>ä½“éªŒç²¾å½©çš„æ¸¸æˆä¸–ç•Œï¼Œèµ¢å–ä¸°åšå¥–åŠ±ï¼</p>
                        <div class="hero-stats">
                            <div class="stat-item">
                                <i class="fas fa-users"></i>
                                <span>10,000+ ç©å®¶</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-trophy"></i>
                                <span>æ¯æ—¥å¤§å¥–</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-star"></i>
                                <span>5æ˜Ÿå¥½è¯„</span>
                            </div>
                        </div>
                        <button onclick="showSection('games')" class="btn btn-large btn-primary btn-pulse">
                            <i class="fas fa-rocket"></i> ç«‹å³å¼€å§‹æ¸¸æˆ
                        </button>
                    </div>
                    <div class="hero-decoration">
                        <div class="floating-icon" style="--delay: 0s;">ğŸ²</div>
                        <div class="floating-icon" style="--delay: 1s;">ğŸ°</div>
                        <div class="floating-icon" style="--delay: 2s;">ğŸ¯</div>
                        <div class="floating-icon" style="--delay: 3s;">ğŸ†</div>
                        <div class="floating-icon" style="--delay: 4s;">ğŸ’</div>
                        <div class="floating-icon" style="--delay: 5s;">ğŸŠ</div>
                    </div>
                </div>

                <div class="features">
                    <div class="feature-card">
                        <i class="fas fa-ticket-alt"></i>
                        <h3>åˆ®åˆ®ä¹</h3>
                        <p>å¤šç§ä¸»é¢˜åˆ®åˆ®ä¹ï¼Œåˆ®å‡ºæƒŠå–œå¤§å¥–</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-coins"></i>
                        <h3>è€è™æœº</h3>
                        <p>ç»å…¸è€è™æœºæ¸¸æˆï¼Œè½¬å‡ºå¹¸è¿ç»„åˆ</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-circle-notch"></i>
                        <h3>å¹¸è¿è½¬ç›˜</h3>
                        <p>è½¬åŠ¨å‘½è¿ä¹‹è½®ï¼Œè·å¾—ä¸°åšå¥–åŠ±</p>
                    </div>
                </div>
            </section>

            <!-- æ¸¸æˆå¤§å… -->
            <section id="games-section" class="section">
                <div class="section-header">
                    <h2>æ¸¸æˆå¤§å…</h2>
                    <p>é€‰æ‹©ä½ å–œæ¬¢çš„æ¸¸æˆå¼€å§‹ä½“éªŒ</p>
                </div>

                <div class="game-categories">
                    <div class="game-category">
                        <h3><i class="fas fa-ticket-alt"></i> åˆ®åˆ®ä¹æ¸¸æˆ</h3>
                        <div id="scratch-games" class="game-grid">
                            <!-- åˆ®åˆ®ä¹æ¸¸æˆå°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>

                    <div class="game-category">
                        <h3><i class="fas fa-coins"></i> è€è™æœºæ¸¸æˆ</h3>
                        <div id="slot-games" class="game-grid">
                            <!-- è€è™æœºæ¸¸æˆå°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>

                    <div class="game-category">
                        <h3><i class="fas fa-circle-notch"></i> å¹¸è¿è½¬ç›˜</h3>
                        <div id="wheel-games" class="game-grid">
                            <!-- è½¬ç›˜æ¸¸æˆå°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- åˆ®åˆ®ä¹æ¸¸æˆé¡µé¢ -->
            <section id="scratch-card-game" class="section">
                <div class="game-header">
                    <h2 id="scratch-game-title">åˆ®åˆ®ä¹</h2>
                    <button onclick="showSection('games')" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> è¿”å›å¤§å…
                    </button>
                </div>

                <div class="scratch-card-container">
                    <div id="scratch-card-container" class="scratch-card">
                        <!-- Canvasåˆ®åˆ®ä¹å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
                    </div>

                    <div class="game-controls">
                        <button id="scratch-settings-btn" onclick="showScratchSettings()" class="btn btn-outline">
                            <i class="fas fa-cog"></i> åˆ®åˆ€è®¾ç½®
                        </button>
                        <button id="new-game-btn" onclick="startNewGame()" class="btn btn-success" style="display: none;">
                            <i class="fas fa-plus"></i> å†æ¥ä¸€å¼ 
                        </button>
                        <button id="scratch-all-btn" onclick="scratchAll()" class="btn btn-primary" style="display: none;">
                            <i class="fas fa-hand-paper"></i> å…¨éƒ¨åˆ®å¼€
                        </button>
                    </div>
                </div>

                <div class="game-result" id="game-result" style="display: none;">
                    <div class="result-content">
                        <div id="result-icon" class="result-icon"></div>
                        <h3 id="result-title"></h3>
                        <div id="result-details" class="result-details"></div>
                    </div>
                </div>
            </section>

            <!-- æ•°æ®ç»Ÿè®¡ -->
            <section id="stats-section" class="section">
                <div class="section-header">
                    <h2>æ•°æ®ç»Ÿè®¡</h2>
                    <p>æŸ¥çœ‹ä½ çš„æ¸¸æˆæ•°æ®å’Œæ’è¡Œæ¦œ</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ä¸ªäººç»Ÿè®¡</h3>
                        <div id="user-stats">
                            <div class="stat-item">
                                <span class="stat-label">æ€»æ¸¸æˆæ¬¡æ•°:</span>
                                <span id="total-games" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æ€»æŠ•å…¥:</span>
                                <span id="total-bet" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">æ€»æ”¶ç›Š:</span>
                                <span id="total-win" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">èƒœç‡:</span>
                                <span id="win-rate" class="stat-value">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3>é‡‘é¢æ’è¡Œæ¦œ</h3>
                        <div id="credits-leaderboard" class="leaderboard">
                            <!-- æ’è¡Œæ¦œå°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ä¸ªäººä¸­å¿ƒ -->
            <section id="profile-section" class="section">
                <div class="section-header">
                    <h2>ä¸ªäººä¸­å¿ƒ</h2>
                    <p>ç®¡ç†ä½ çš„è´¦æˆ·ä¿¡æ¯</p>
                </div>

                <div class="profile-content">
                    <div class="profile-card">
                        <h3>è´¦æˆ·ä¿¡æ¯</h3>
                        <div id="profile-info">
                            <!-- ä¸ªäººä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>

                    <div class="profile-card">
                        <h3>æ¸¸æˆå†å²</h3>
                        <div id="game-history" class="history-list">
                            <!-- æ¸¸æˆå†å²å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ç™»å½•æ¨¡æ€æ¡† -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ç”¨æˆ·ç™»å½•</h3>
                    <span class="close" onclick="closeModal('login-modal')">&times;</span>
                </div>
                <form id="login-form" onsubmit="login(event)">
                    <div class="form-group">
                        <label for="login-username">ç”¨æˆ·å:</label>
                        <input type="text" id="login-username" placeholder="è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">å¯†ç :</label>
                        <input type="password" id="login-password" placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç " required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> ç«‹å³ç™»å½•
                    </button>

                    <div class="admin-hint">
                        <i class="fas fa-info-circle"></i>
                        <span>ç®¡ç†å‘˜è´¦æˆ·: admin / admin123</span>
                        <br>
                        <a href="admin-login.html" style="color: #667eea; text-decoration: none; font-weight: 600;">
                            <i class="fas fa-external-link-alt"></i> ç›´æ¥è¿›å…¥ç®¡ç†åå°
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
        <div id="register-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ç”¨æˆ·æ³¨å†Œ</h3>
                    <span class="close" onclick="closeModal('register-modal')">&times;</span>
                </div>
                <form id="register-form" onsubmit="register(event)">
                    <div class="form-group">
                        <label for="register-username">ç”¨æˆ·å:</label>
                        <input type="text" id="register-username" placeholder="è¯·è¾“å…¥3-20ä¸ªå­—ç¬¦çš„ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">é‚®ç®±:</label>
                        <input type="email" id="register-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">å¯†ç :</label>
                        <input type="password" id="register-password" placeholder="è¯·è¾“å…¥6ä½ä»¥ä¸Šçš„å¯†ç " required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-user-plus"></i> ç«‹å³æ³¨å†Œ
                    </button>
                </form>
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div id="message" class="message"></div>
    </div>

    <!-- åˆ®åˆ€è®¾ç½®å¼¹çª— -->
    <div id="scratch-settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content scratch-settings-modal">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> åˆ®åˆ€è®¾ç½®</h3>
                <button class="modal-close" onclick="hideScratchSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label><i class="fas fa-mouse-pointer"></i> åˆ®åˆ€æ ·å¼</label>
                    <div class="setting-options">
                        <button class="setting-btn active" data-tool="default" onclick="setScratchTool('default')">
                            <i class="fas fa-circle"></i> é»˜è®¤
                        </button>
                        <button class="setting-btn" data-tool="coin" onclick="setScratchTool('coin')">
                            <i class="fas fa-coins"></i> ç¡¬å¸
                        </button>
                        <button class="setting-btn" data-tool="brush" onclick="setScratchTool('brush')">
                            <i class="fas fa-paint-brush"></i> åˆ·å­
                        </button>
                        <button class="setting-btn" data-tool="diamond" onclick="setScratchTool('diamond')">
                            <i class="fas fa-gem"></i> é’»çŸ³
                        </button>
                        <button class="setting-btn" data-tool="finger" onclick="setScratchTool('finger')">
                            <i class="fas fa-hand-point-up"></i> æ‰‹æŒ‡
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <label><i class="fas fa-hammer"></i> åˆ®åˆ€ç¡¬åº¦</label>
                    <div class="setting-options">
                        <button class="setting-btn" data-hardness="soft" onclick="setScratchHardness('soft')">
                            <i class="fas fa-feather"></i> æŸ”è½¯
                        </button>
                        <button class="setting-btn active" data-hardness="medium" onclick="setScratchHardness('medium')">
                            <i class="fas fa-circle"></i> ä¸­ç­‰
                        </button>
                        <button class="setting-btn" data-hardness="hard" onclick="setScratchHardness('hard')">
                            <i class="fas fa-square"></i> åšç¡¬
                        </button>
                        <button class="setting-btn" data-hardness="ultra" onclick="setScratchHardness('ultra')">
                            <i class="fas fa-cube"></i> è¶…ç¡¬
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <label><i class="fas fa-magic"></i> ç‰¹æ•ˆæ¨¡å¼</label>
                    <div class="setting-options">
                        <button class="setting-btn active" data-effect="normal" onclick="setScratchEffects('normal')">
                            <i class="fas fa-circle"></i> æ™®é€š
                        </button>
                        <button class="setting-btn" data-effect="sparkle" onclick="setScratchEffects('sparkle')">
                            <i class="fas fa-sparkles"></i> é—ªå…‰
                        </button>
                        <button class="setting-btn" data-effect="fire" onclick="setScratchEffects('fire')">
                            <i class="fas fa-fire"></i> ç«ç„°
                        </button>
                        <button class="setting-btn" data-effect="ice" onclick="setScratchEffects('ice')">
                            <i class="fas fa-snowflake"></i> å†°éœœ
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <label><i class="fas fa-volume-up"></i> å£°éŸ³æ•ˆæœ</label>
                    <div class="setting-options">
                        <button class="setting-btn active" data-sound="default" onclick="setScratchSound('default')">
                            <i class="fas fa-volume-up"></i> é»˜è®¤
                        </button>
                        <button class="setting-btn" data-sound="coin" onclick="setScratchSound('coin')">
                            <i class="fas fa-coins"></i> ç¡¬å¸
                        </button>
                        <button class="setting-btn" data-sound="paper" onclick="setScratchSound('paper')">
                            <i class="fas fa-file"></i> çº¸å¼ 
                        </button>
                        <button class="setting-btn" data-sound="metal" onclick="setScratchSound('metal')">
                            <i class="fas fa-tools"></i> é‡‘å±
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideScratchSettings()">
                    <i class="fas fa-check"></i> ç¡®å®š
                </button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/games.js"></script>
    <script src="js/compatibility-handler.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/canvas-scratch-engine.js"></script>
    <script src="js/enhanced-scratch-effects.js"></script>
    <script src="js/advanced-visual-effects.js"></script>
    <script src="js/canvas-scratch-integration-fixed.js" onload="console.log('âœ… canvas-scratch-integration-fixed.js åŠ è½½æˆåŠŸ')" onerror="console.error('âŒ canvas-scratch-integration-fixed.js åŠ è½½å¤±è´¥')"></script>
    <script src="js/app.js"></script>

    <!-- ä¸´æ—¶è°ƒè¯•å·¥å…· -->
    <script>
        setTimeout(() => {
            // æ£€æŸ¥Canvasé›†æˆæ¨¡å—åˆå§‹åŒ–çŠ¶æ€
            console.log('ğŸ” æ£€æŸ¥Canvasé›†æˆæ¨¡å—çŠ¶æ€:');
            console.log('- CanvasScratchEngine:', !!window.CanvasScratchEngine);
            console.log('- EnhancedScratchEffects:', !!window.EnhancedScratchEffects);
            console.log('- CanvasScratchIntegrationç±»:', !!window.CanvasScratchIntegration);
            console.log('- canvasScratchIntegrationå®ä¾‹:', !!window.canvasScratchIntegration);
            console.log('- initializeCanvasIntegrationå‡½æ•°:', !!window.initializeCanvasIntegration);
            console.log('- renderScratchCardå‡½æ•°:', typeof window.renderScratchCard);

            // ç›‘æ§å…¨å±€å˜é‡å˜åŒ–
            let lastCardData = null;
            setInterval(() => {
                if (window.currentScratchCard !== lastCardData) {
                    console.log('ğŸ” å…¨å±€å¡ç‰‡æ•°æ®å‘ç”Ÿå˜åŒ–:', {
                        from: lastCardData,
                        to: window.currentScratchCard,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    lastCardData = window.currentScratchCard;
                }
            }, 1000);

            // æ·»åŠ è°ƒè¯•æŒ‰é’®
            const debugBtn = document.createElement('button');
            debugBtn.innerHTML = 'ğŸ› è°ƒè¯•å¥–åŠ±';
            debugBtn.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 9999;
                background: #ff4444;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            debugBtn.onclick = () => {
                console.log('=== è¯¦ç»†è°ƒè¯•å¥–åŠ±ä¿¡æ¯ ===');
                console.log('å…¨å±€å¡ç‰‡æ•°æ®:', window.currentScratchCard);
                console.log('å…¨å±€æ¨¡æ¿æ•°æ®:', window.currentScratchTemplate);
                console.log('Canvasé›†æˆæ¨¡å—:', window.canvasScratchIntegration);
                console.log('Canvasé›†æˆæ¨¡å—çš„å¡ç‰‡æ•°æ®:', window.canvasScratchIntegration?.currentCardData);

                // æµ‹è¯•Canvasæ¸²æŸ“
                if (window.canvasScratchIntegration && window.currentScratchCard) {
                    console.log('ğŸ§ª æµ‹è¯•Canvasæ¸²æŸ“...');
                    window.canvasScratchIntegration.renderCanvasScratchCard(window.currentScratchCard);
                }

                // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„æ•°æ®æº
                const dataSources = [
                    { name: 'window.currentScratchCard', data: window.currentScratchCard },
                    { name: 'canvasScratchIntegration.currentCardData', data: window.canvasScratchIntegration?.currentCardData },
                    { name: 'canvasScratchIntegration.engine.cardData', data: window.canvasScratchIntegration?.engine?.cardData }
                ];

                let foundData = null;
                let debugInfo = 'æ•°æ®æºæ£€æŸ¥ç»“æœ:\n\n';

                dataSources.forEach(source => {
                    debugInfo += `${source.name}:\n`;
                    if (source.data) {
                        debugInfo += `  å­˜åœ¨: æ˜¯\n`;
                        debugInfo += `  ä¸­å¥–: ${source.data.is_winner}\n`;
                        debugInfo += `  å¥–å“: ${JSON.stringify(source.data.prize_info)}\n`;

                        if (source.data.is_winner && source.data.prize_info?.credits > 0) {
                            foundData = source.data;
                        }
                    } else {
                        debugInfo += `  å­˜åœ¨: å¦\n`;
                    }
                    debugInfo += '\n';
                });

                console.log(debugInfo);
                alert(debugInfo);

                if (foundData) {
                    const prize = foundData.prize_info;
                    alert(`æ‰¾åˆ°ä¸­å¥–æ•°æ®ï¼
å¥–å“åç§°: ${prize.name}
å¥–åŠ±é‡‘é¢: ${prize.credits} å…ƒ`);
                    showCorrectRewardModal(prize);
                } else {
                    alert('æ‰€æœ‰æ•°æ®æºéƒ½æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„ä¸­å¥–æ•°æ®ï¼');
                }
            };
            document.body.appendChild(debugBtn);

            // æ·»åŠ Canvasæµ‹è¯•æŒ‰é’®
            const canvasTestBtn = document.createElement('button');
            canvasTestBtn.innerHTML = 'ğŸ¨ æµ‹è¯•Canvas';
            canvasTestBtn.style.cssText = `
                position: fixed;
                top: 120px;
                right: 20px;
                z-index: 10000;
                padding: 10px;
                background: #28a745;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            `;
            canvasTestBtn.onclick = () => {
                console.log('=== Canvasæµ‹è¯•å¼€å§‹ ===');

                // æ£€æŸ¥å®¹å™¨
                const container = document.getElementById('scratch-card-container');
                console.log('å®¹å™¨å­˜åœ¨:', !!container);
                if (container) {
                    console.log('å®¹å™¨å°ºå¯¸:', container.offsetWidth, 'x', container.offsetHeight);
                }

                // æ£€æŸ¥Canvasé›†æˆæ¨¡å—
                console.log('Canvasé›†æˆæ¨¡å—å­˜åœ¨:', !!window.canvasScratchIntegration);

                // åˆ›å»ºæµ‹è¯•æ•°æ®
                const testData = {
                    template_id: "welfare_lottery",
                    template_name: "ç¦åˆ©å½©ç¥¨åˆ®åˆ®ä¹",
                    card_type: "lucky_symbol",
                    theme: "ç¦åˆ©å½©ç¥¨",
                    cost: 10,
                    layout: { cols: 6, rows: 5 },
                    areas: [
                        { id: 0, content: "ğŸ", is_scratched: false, is_winner: false },
                        { id: 1, content: "ğŸŠ", is_scratched: false, is_winner: false },
                        { id: 2, content: "ğŸŒ", is_scratched: false, is_winner: false },
                        { id: 3, content: "ğŸ‡", is_scratched: false, is_winner: false },
                        { id: 4, content: "ğŸ", is_scratched: false, is_winner: true },
                        { id: 5, content: "ğŸ", is_scratched: false, is_winner: false }
                    ],
                    is_winner: true,
                    prize_info: {
                        name: "å¹¸è¿å¥–é‡‘",
                        credits: 50,
                        type: "credits"
                    },
                    user_id: 1
                };

                // è®¾ç½®å…¨å±€æ•°æ®
                window.currentScratchCard = testData;
                window.currentScratchTemplate = {
                    id: 'welfare_lottery',
                    name: 'ç¦åˆ©å½©ç¥¨åˆ®åˆ®ä¹',
                    layout: { cols: 6, rows: 5 }
                };

                // åˆ‡æ¢åˆ°åˆ®åˆ®ä¹é¡µé¢
                showSection('scratch-card-game');

                // è°ƒç”¨æ¸²æŸ“å‡½æ•°
                if (window.canvasScratchIntegration) {
                    console.log('è°ƒç”¨Canvasæ¸²æŸ“...');
                    window.canvasScratchIntegration.renderCanvasScratchCard(testData);
                } else {
                    console.error('Canvasé›†æˆæ¨¡å—ä¸å­˜åœ¨');
                }
            };
            document.body.appendChild(canvasTestBtn);

            // æ·»åŠ æ‰‹åŠ¨å¼€å§‹æ¸¸æˆæŒ‰é’®
            const startGameBtn = document.createElement('button');
            startGameBtn.style.cssText = `
                position: fixed;
                top: 60px;
                right: 10px;
                z-index: 9999;
                background: #44ff44;
                color: black;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            startGameBtn.textContent = 'ğŸ® å¼€å§‹æ¸¸æˆ';
            startGameBtn.onclick = async () => {
                console.log('=== ğŸ® å¼€å§‹æ¸¸æˆæŒ‰é’®è¢«ç‚¹å‡» ===');
                console.log('æŒ‰é’®ç‚¹å‡»æ—¶é—´:', new Date().toLocaleTimeString());

                try {
                    // ä½¿ç”¨ç°æœ‰çš„APIå®ä¾‹
                    if (!window.api) {
                        console.error('APIå®ä¾‹ä¸å­˜åœ¨');
                        return;
                    }

                    console.log('ğŸ® è°ƒç”¨åˆ®åˆ®ä¹API...');
                    const result = await window.api.playScratchCard('welfare_lottery');
                    console.log('ğŸ‰ æ¸¸æˆç»“æœ:', result);

                    let totalCredits = 0;
                    let prizeName = 'è°¢è°¢å‚ä¸';

                    if (result.is_winner && result.prize_info) {
                        totalCredits = result.prize_info.credits || 0;
                        prizeName = result.prize_info.name || 'å¥–é‡‘';
                    }

                    console.log('ä¸­å¥–çŠ¶æ€:', result.is_winner);
                    console.log('å¥–å“åç§°:', prizeName);
                    console.log('å¥–é‡‘é‡‘é¢:', totalCredits);

                    // æ˜¾ç¤ºç®€å•çš„alertç»“æœ
                    alert(`æ¸¸æˆç»“æœ:\nä¸­å¥–çŠ¶æ€: ${result.is_winner}\nå¥–å“: ${prizeName}\né‡‘é¢: ${totalCredits}å…ƒ`);

                } catch (error) {
                    console.error('æ¸¸æˆå¤±è´¥:', error);
                    alert('æ¸¸æˆå¤±è´¥: ' + error.message);
                }

                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                console.log('å½“å‰ç”¨æˆ·:', window.currentUser);
                console.log('API token:', window.api?.token);

                // ç›´æ¥è°ƒç”¨åˆ®åˆ®ä¹API
                console.log('ğŸ® ç›´æ¥è°ƒç”¨åˆ®åˆ®ä¹API...');
                try {
                    const result = await window.api.playScratchCard('welfare_lottery');
                    console.log('ğŸ‰ æ¸¸æˆç»“æœ:', result);

                    // ä¿å­˜åˆ°å…¨å±€å˜é‡
                    window.currentScratchCard = result;

                    // æ‰‹åŠ¨åˆ›å»ºå¥–åŠ±å¼¹çª—
                    console.log('ğŸ† æ‰‹åŠ¨åˆ›å»ºå¥–åŠ±å¼¹çª—...');

                    let totalCredits = 0;
                    let prizeName = 'è°¢è°¢å‚ä¸';

                    if (result.is_winner && result.prize_info) {
                        totalCredits = result.prize_info.credits || 0;
                        prizeName = result.prize_info.name || 'å¥–é‡‘';
                    }

                    console.log('ä¸­å¥–çŠ¶æ€:', result.is_winner);
                    console.log('å¥–å“åç§°:', prizeName);
                    console.log('å¥–é‡‘é‡‘é¢:', totalCredits);

                    // ç§»é™¤å·²å­˜åœ¨çš„å¼¹çª—
                    const existingModal = document.getElementById('simple-reward-modal');
                    if (existingModal) {
                        existingModal.remove();
                    }

                } catch (error) {
                    console.error('APIè°ƒç”¨å¤±è´¥:', error);
                    alert('æ¸¸æˆå¤±è´¥: ' + error.message);
                }

                // è®¾ç½®é»˜è®¤æ¨¡æ¿
                if (!window.currentScratchTemplate) {
                    window.currentScratchTemplate = { id: 'welfare_lottery', name: 'ç¦åˆ©å½©ç¥¨åˆ®åˆ®ä¹' };
                    console.log('è®¾ç½®é»˜è®¤æ¨¡æ¿:', window.currentScratchTemplate);
                }

                // æ‰‹åŠ¨åˆ›å»ºCanvasé›†æˆæ¨¡å—å®ä¾‹
                if (!window.canvasScratchIntegration && window.CanvasScratchIntegration) {
                    console.log('æ‰‹åŠ¨åˆ›å»ºCanvasé›†æˆæ¨¡å—å®ä¾‹...');
                    window.canvasScratchIntegration = new window.CanvasScratchIntegration();
                }

                // å…ˆå°è¯•åˆå§‹åŒ–Canvasé›†æˆæ¨¡å—
                if (window.initializeCanvasIntegration) {
                    window.initializeCanvasIntegration();
                } else if (window.canvasScratchIntegration) {
                    console.log('ä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºçš„Canvasé›†æˆæ¨¡å—å®ä¾‹');
                }

                if (window.startScratchCardGame) {
                    try {
                        await window.startScratchCardGame();
                    } catch (error) {
                        console.error('æ¸¸æˆå¼€å§‹å¤±è´¥:', error);
                    }
                } else {
                    console.log('âŒ startScratchCardGame å‡½æ•°ä¸å­˜åœ¨');

                    // å¦‚æœstartScratchCardGameä¸å­˜åœ¨ï¼Œç›´æ¥è°ƒç”¨APIæµ‹è¯•ä¸­å¥–
                    console.log('ğŸ® ç›´æ¥è°ƒç”¨åˆ®åˆ®ä¹API...');
                    try {
                        const result = await window.api.playScratchCard('welfare_lottery');
                        console.log('ğŸ‰ æ¸¸æˆç»“æœ:', result);

                        // ä¿å­˜åˆ°å…¨å±€å˜é‡
                        window.currentScratchCard = result;

                        // æ‰‹åŠ¨åˆ›å»ºå¥–åŠ±å¼¹çª—
                        console.log('ğŸ† æ‰‹åŠ¨åˆ›å»ºå¥–åŠ±å¼¹çª—...');

                        let totalCredits = 0;
                        let prizeName = 'è°¢è°¢å‚ä¸';

                        if (result.is_winner && result.prize_info) {
                            totalCredits = result.prize_info.credits || 0;
                            prizeName = result.prize_info.name || 'å¥–é‡‘';
                        }

                        console.log('ä¸­å¥–çŠ¶æ€:', result.is_winner);
                        console.log('å¥–å“åç§°:', prizeName);
                        console.log('å¥–é‡‘é‡‘é¢:', totalCredits);

                        // åˆ›å»ºç®€å•çš„å¥–åŠ±å¼¹çª—
                        const modalHTML =
                            '<div id="simple-reward-modal" style="' +
                                'position: fixed;' +
                                'top: 0;' +
                                'left: 0;' +
                                'width: 100%;' +
                                'height: 100%;' +
                                'background: rgba(0,0,0,0.8);' +
                                'display: flex;' +
                                'justify-content: center;' +
                                'align-items: center;' +
                                'z-index: 10000;' +
                            '">' +
                                '<div style="' +
                                    'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);' +
                                    'padding: 40px;' +
                                    'border-radius: 20px;' +
                                    'text-align: center;' +
                                    'color: white;' +
                                    'box-shadow: 0 20px 40px rgba(0,0,0,0.3);' +
                                    'max-width: 400px;' +
                                    'width: 90%;' +
                                '">' +
                                    '<h2 style="margin: 0 0 20px 0; font-size: 24px;">ğŸ‰ æ­å–œä¸­å¥–</h2>' +
                                    '<div style="font-size: 18px; margin: 15px 0;">' +
                                        'å¥–å“ï¼š' + prizeName +
                                    '</div>' +
                                    '<div style="font-size: 32px; font-weight: bold; margin: 20px 0; color: #FFD700;">' +
                                        'æ€»é‡‘é¢: ' + totalCredits + ' å…ƒ' +
                                    '</div>' +
                                    '<button onclick="document.getElementById(\'simple-reward-modal\').remove()" style="' +
                                        'background: #4CAF50;' +
                                        'color: white;' +
                                        'border: none;' +
                                        'padding: 12px 30px;' +
                                        'border-radius: 25px;' +
                                        'font-size: 16px;' +
                                        'cursor: pointer;' +
                                        'margin-top: 20px;' +
                                    '">ç¡®å®š</button>' +
                                '</div>' +
                            '</div>';

                        document.body.insertAdjacentHTML('beforeend', modalHTML);

                    } catch (error) {
                        console.error('APIè°ƒç”¨å¤±è´¥:', error);
                    }
                }
            };
            document.body.appendChild(startGameBtn);

            // æ·»åŠ APIæµ‹è¯•æŒ‰é’®
            const testApiBtn = document.createElement('button');
            testApiBtn.style.cssText = `
                position: fixed;
                top: 100px;
                right: 10px;
                z-index: 9999;
                background: #ff4444;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            `;
            testApiBtn.textContent = 'ğŸ”§ æµ‹è¯•API';
            testApiBtn.onclick = async () => {
                console.log('=== APIæµ‹è¯•å¼€å§‹ ===');

                // æ‰‹åŠ¨å®šä¹‰APIç±»ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                if (!window.API) {
                    console.log('æ‰‹åŠ¨åˆ›å»ºAPIç±»...');
                    window.API = class API {
                        constructor() {
                            this.baseURL = 'http://localhost:8000';
                            this.token = localStorage.getItem('token');
                        }

                        setToken(token) {
                            this.token = token;
                            localStorage.setItem('token', token);
                        }

                        getHeaders() {
                            const headers = { 'Content-Type': 'application/json' };
                            if (this.token) {
                                headers['Authorization'] = `Bearer ${this.token}`;
                            }
                            return headers;
                        }

                        async playScratchCard(templateId) {
                            const response = await fetch(`${this.baseURL}/api/games/scratch-card/play`, {
                                method: 'POST',
                                headers: this.getHeaders(),
                                body: JSON.stringify({ template_id: templateId })
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                            }

                            return await response.json();
                        }

                        async getCurrentUser() {
                            const response = await fetch(`${this.baseURL}/api/auth/me`, {
                                headers: this.getHeaders()
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                            }

                            return await response.json();
                        }
                    };
                }

                // åˆ›å»ºAPIå®ä¾‹
                if (!window.api) {
                    console.log('åˆ›å»ºAPIå®ä¾‹...');
                    window.api = new window.API();
                }

                // æ£€æŸ¥åŸºæœ¬çŠ¶æ€
                console.log('å½“å‰ç”¨æˆ·:', window.currentUser);
                console.log('APIå®ä¾‹:', window.api);
                console.log('APIç±»:', window.API);
                console.log('API token:', window.api?.token);
                console.log('localStorage token:', localStorage.getItem('token'));

                // æµ‹è¯•APIè¿æ¥
                try {
                    console.log('æµ‹è¯•APIè¿æ¥...');
                    const response = await fetch('http://localhost:8000/health');
                    console.log('å¥åº·æ£€æŸ¥å“åº”:', response.status);

                    if (window.api && window.api.token) {
                        console.log('æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API...');
                        const userInfo = await window.api.getCurrentUser();
                        console.log('ç”¨æˆ·ä¿¡æ¯APIå“åº”:', userInfo);

                        console.log('æµ‹è¯•åˆ®åˆ®ä¹API...');
                        const gameResponse = await window.api.playScratchCard('welfare_lottery');
                        console.log('ğŸ‰ æ¸¸æˆAPIå“åº”:', gameResponse);

                        // æ£€æŸ¥å“åº”ä¸­çš„prize_info
                        if (gameResponse && gameResponse.card_data) {
                            console.log('=== æ¸¸æˆæ•°æ®æ£€æŸ¥ ===');
                            console.log('is_winner:', gameResponse.card_data.is_winner);
                            console.log('prize_info:', gameResponse.card_data.prize_info);
                            console.log('prize_infoå­˜åœ¨:', 'prize_info' in gameResponse.card_data);
                        }
                    } else {
                        console.log('âŒ æ²¡æœ‰æœ‰æ•ˆçš„API token');
                    }
                } catch (error) {
                    console.error('APIæµ‹è¯•å¤±è´¥:', error);
                }
            };
            document.body.appendChild(testApiBtn);

            // å¼ºåˆ¶æ˜¾ç¤ºæ­£ç¡®å¥–åŠ±çš„å‡½æ•°
            window.showCorrectRewardModal = function(prize) {
                // ç§»é™¤å·²å­˜åœ¨çš„å¼¹çª—
                const existingModal = document.getElementById('reward-modal');
                if (existingModal) {
                    existingModal.remove();
                }

                // åˆ›å»ºæ­£ç¡®çš„å¥–åŠ±å¼¹çª—
                const modalHTML = `
                    <div id="reward-modal" class="modal-overlay" style="display: flex;">
                        <div class="modal-content reward-modal">
                            <div class="modal-header">
                                <h3><i class="fas fa-trophy"></i> å¥–åŠ±ç»“ç®— âœ¨</h3>
                                <button class="modal-close" onclick="document.getElementById('reward-modal').remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="reward-summary">
                                    <div class="total-points">
                                        <i class="fas fa-coins"></i>
                                        <span>æ€»é‡‘é¢: ${prize.credits} å…ƒ</span>
                                    </div>
                                </div>
                                <div class="reward-items">
                                    <div class="reward-item">
                                        <i class="fas fa-coins"></i>
                                        <span>${prize.name}</span>
                                        <span class="points">+${prize.credits} å…ƒ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" onclick="document.getElementById('reward-modal').remove()">
                                    <i class="fas fa-check"></i> ç¡®è®¤æ”¶å–
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', modalHTML);
            };

        }, 3000);
    </script>
</body>
</html>
